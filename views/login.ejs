<%-include("partials/header-signin.ejs");-%>

<form class="form-signin">
    <img class="mb-4 bilde" src="Img/Huggern.png" alt="Bilde av Huggern">
    <h1 class="h3 mb-3 fw-normal title-text">Logg inn med oAuth 2.0</h1>

    <div class="g-signin2 btn" data-onsuccess="onSignIn"></div> <br>
    <a href="/">Til startside aka risikoanalyse</a>

    <p class="mt-5 mb-3 foorter-text">Â© 2022 - Ram</p>
</form>
  

    <script>

    function onSignIn(googleUser) {
      let id_token = googleUser.getAuthResponse().id_token;
      let xhr = new XMLHttpRequest();
      xhr.open("POST", "/login");
      xhr.setRequestHeader("Content-Type", "application/json");
      xhr.onload = function() {
        if (xhr.responseText === "Success") {
          signOut();
          location.assign("/dashboard");
          console.log("User signed in.");
        }
      };
      xhr.send(JSON.stringify({token: id_token}));
    }
    </script>


<script>
    function signOut() {
      var auth2 = gapi.auth2.getAuthInstance();
      auth2.signOut().then(function () {
        console.log('User signed out.');
      });
    }
  </script>

  <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>
  <script src="https://apis.google.com/js/platform.js?onload=init" async defer></script>
<%-include("partials/footer.ejs");-%>